includes:
  - python-file: openstack_functions.py

pipelines:
  - name: check
    manager: IndependentPipelineManager
    trigger:
      gerrit:
        - event: patchset-created
        - event: change-restored
        - event: comment-added
          comment_filter: (?i)^(Patch Set [0-9]+:\n\n)?\s*recheck(( (?:bug|lp)[\s#:]*(\d+))|( no bug)|( savanna-ci)|( sahara-ci))\s*$
        - event: comment-added
          require-approval:
            - username: savanna-ci
              older-than: 48h
    start:
      gerrit:
        verified: 0
    success:
      gerrit:
        verified: 1
    failure:
      gerrit:
        verified: -1
  - name: post
    manager: IndependentPipelineManager
    trigger:
      gerrit:
        - event: change-merged
        - event: comment-added
          comment_filter: (?i)^\s*rebuild(( sahara-ci))\s*$

projects:
  - name: openstack/sahara
    check:
      - gate-sahara-integration-vanilla-1
      - gate-sahara-integration-vanilla-2.3
      - gate-sahara-integration-vanilla-2.4
      - gate-sahara-integration-heat-vanilla1
      - gate-sahara-integration-hdp1
      - gate-sahara-integration-hdp2
      - gate-sahara-integration-transient
      - gate-savanna-pep8-trunk

  - name: openstack/python-saharaclient
    check:
      - gate-saharaclient-integration-vanilla-1
      - gate-saharaclient-integration-vanilla-2.3
      - gate-saharaclient-integration-vanilla-2.4
      - gate-saharaclient-integration-heat-vanilla1
      - gate-saharaclient-integration-hdp1
      - gate-saharaclient-integration-hdp2
      - gate-saharaclient-integration-transient
      - gate-savanna-pep8-trunk

  - name: openstack/sahara-dashboard
    check:
      - gate-ui-tests

  - name: openstack/sahara-image-elements
    check:
      - diskimage-integration-vanilla-ubuntu-1
      - diskimage-integration-vanilla-fedora-1
      - diskimage-integration-vanilla-centos-1
      - diskimage-integration-vanilla-ubuntu-2.3
      - diskimage-integration-vanilla-fedora-2.3
      - diskimage-integration-vanilla-centos-2.3
      - diskimage-integration-vanilla-ubuntu-2.4
      - diskimage-integration-vanilla-fedora-2.4
      - diskimage-integration-vanilla-centos-2.4
      - diskimage-integration-spark
      - diskimage-integration-hdp1
      - diskimage-integration-hdp2
    post:
      - diskimage-integration-vanilla-ubuntu-1
      - diskimage-integration-vanilla-fedora-1
      - diskimage-integration-vanilla-centos-1
      - diskimage-integration-vanilla-ubuntu-2.3
      - diskimage-integration-vanilla-fedora-2.3
      - diskimage-integration-vanilla-centos-2.3
      - diskimage-integration-vanilla-ubuntu-2.4
      - diskimage-integration-vanilla-fedora-2.4
      - diskimage-integration-vanilla-centos-2.4
      - diskimage-integration-spark
      - diskimage-integration-hdp1
      - diskimage-integration-hdp2

jobs:
  - name: ^.*$
    parameter-function: set_ci_tenant
    branch: ^(master|milestone-proposed|stable/icehouse)$
  - name: diskimage-integration-hdp2
    voting: false
  - name: gate-savanna-pep8-trunk
    voting: false
  - name: diskimage-integration-vanilla-ubuntu-2.4
    voting: false
  - name: diskimage-integration-vanilla-fedora-2.4
    voting: false
  - name: diskimage-integration-vanilla-centos-2.4
    voting: false
  - name: gate-saharaclient-integration-vanilla-2.4
    voting: false
  - name: gate-sahara-integration-vanilla-2.4
    voting: false
