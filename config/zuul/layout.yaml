includes:
  - python-file: openstack_functions.py

pipelines:
  - name: check
    manager: IndependentPipelineManager
    trigger:
      gerrit:
        - event: patchset-created
        - event: change-restored
        - event: comment-added
          comment: (?i)^(Patch Set [0-9]+:)?( [\w\\+-]*)*(\n\n)?\s*(sahara-ci-)?recheck
        - event: comment-added
          require-approval:
            - username: savanna-ci
              older-than: 48h
    start:
      gerrit:
        verified: 0
    success:
      gerrit:
        verified: 1
    failure:
      gerrit:
        verified: -1
  - name: post
    manager: IndependentPipelineManager
    trigger:
      gerrit:
        - event: change-merged
        - event: comment-added
          comment_filter: (?i)^\s*rebuild(( sahara-ci))\s*$

projects:
  - name: openstack/sahara
    check:
      - gate-sahara-integration-vanilla-1
      - gate-sahara-integration-vanilla-2.3
      - gate-sahara-integration-vanilla-2.4
      - gate-sahara-integration-hdp1
      - gate-sahara-integration-hdp2
      - gate-sahara-integration-spark
      - gate-sahara-integration-cdh-centos
      - gate-sahara-integration-cdh-ubuntu
      - gate-sahara-integration-transient
      - gate-sahara-integration-heat_transient
      - gate-sahara-pep8-trunk

  - name: openstack/python-saharaclient
    check:
      - gate-saharaclient-integration-vanilla-1
      - gate-saharaclient-integration-vanilla-2.3
      - gate-saharaclient-integration-vanilla-2.4
      - gate-saharaclient-integration-hdp1
      - gate-saharaclient-integration-hdp2
      - gate-saharaclient-integration-spark
      - gate-saharaclient-integration-cdh-centos
      - gate-saharaclient-integration-cdh-ubuntu
      - gate-saharaclient-integration-transient
      - gate-saharaclient-integration-heat_transient
      - gate-sahara-pep8-trunk

  - name: openstack/sahara-dashboard
    check:
      - gate-uitests-tests

  - name: openstack/horizon
    check:
      - gate-ui-tests

  - name: openstack/sahara-image-elements
    check:
      - diskimage-integration-vanilla-ubuntu-1
      - diskimage-integration-vanilla-fedora-1
      - diskimage-integration-vanilla-centos-1
      - diskimage-integration-vanilla-ubuntu-2.3
      - diskimage-integration-vanilla-fedora-2.3
      - diskimage-integration-vanilla-centos-2.3
      - diskimage-integration-vanilla-ubuntu-2.4
      - diskimage-integration-vanilla-fedora-2.4
      - diskimage-integration-vanilla-centos-2.4
      - diskimage-integration-spark
      - diskimage-integration-cdh-centos
      - diskimage-integration-cdh-ubuntu
      - diskimage-integration-hdp1
      - diskimage-integration-hdp2
    post:
      - diskimage-integration-vanilla-ubuntu-1
      - diskimage-integration-vanilla-fedora-1
      - diskimage-integration-vanilla-centos-1
      - diskimage-integration-vanilla-ubuntu-2.3
      - diskimage-integration-vanilla-fedora-2.3
      - diskimage-integration-vanilla-centos-2.3
      - diskimage-integration-vanilla-ubuntu-2.4
      - diskimage-integration-vanilla-fedora-2.4
      - diskimage-integration-vanilla-centos-2.4
      - diskimage-integration-spark
      - diskimage-integration-cdh-centos
      - diskimage-integration-cdh-ubuntu
      - diskimage-integration-hdp1
      - diskimage-integration-hdp2

jobs:
  - name: ^.*$
    parameter-function: set_ci_tenant
    branch: ^(master|proposed/juno|stable/icehouse)$
  - name: gate-sahara-pep8-trunk
    voting: false
  - name: diskimage-integration-cdh-centos
    voting: false
  - name: diskimage-integration-cdh-ubuntu
    voting: false
  - name: gate-saharaclient-integration-cdh-centos
    voting: false
  - name: gate-saharaclient-integration-cdh-ubuntu
    voting: false
  - name: ^gate-sahara-integration.*$
    files:
      - '^sahara/.*$'
      - '^tools/.*$'
      - '^[^\/]*$'
  - name: ^gate-sahara-integration-cdh-.*$
    voting: false
  - name: gate-ui-tests
    files:
      - '^openstack_dashboard/dashboards/project/data_processing.*$'
      - 'openstack_dashboard/api/sahara.py'
