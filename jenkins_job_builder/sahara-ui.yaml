- job-template:
    name: 'gate-{type}-tests'
    project-type: freestyle
    defaults: global
    description: "<b>This job is managed by Jenkins Job Builder, do not edit it through WebUI.\
                  \n<p>Please use this repository to make changes: <a href=\"https://git.openstack.org/stackforge/sahara-ci-config\">https://git.openstack.org/stackforge/sahara-ci-config</a></b>\
                  \n<p><b>Title</b>: Tests for Sahara dashboard<br/>\
                  \n<b>Description</b>: This job installs Sahara-dashboard and run selenium tests.<br/>\
                  \n<b>Maintainer</b>: Vadim Rovachev<br/>"
    node: ui-neutron
    disabled: false
    concurrent: false

    properties:
      - zeromq-event

    builders:
    - gerrit-git-prep
    - shell:  "rm -rf sahara-ci-config\
             \ngit clone https://git.openstack.org/stackforge/sahara-ci-config\
             \nFUNCTION_PATH=sahara-ci-config/slave-scripts/functions.sh bash -x sahara-ci-config/slave-scripts/gate-ui-tests.sh"

    publishers:
      - console-log
      - workspace-cleanup:
          dirmatch: true
          fail-build: false
          clean-if:
            - success: true
            - not-built: true
            - unstable: true
            - failure: true
            - aborted: true
      - trigger-parameterized-builds:
          - project: "integration-cleanup"
            predefined-parameters:
               "PREV_BUILD=$BUILD_NUMBER-$ZUUL_CHANGE-$ZUUL_PATCHSET\
               \nPREV_JOB=$JOB_NAME\
               \nHOST_NAME=$NODE_NAME"

- project:
    name: sahara-dashboard
    github-org: openstack
    type:
     - ui
     - uitests
    jobs:
     - 'gate-{type}-tests'
