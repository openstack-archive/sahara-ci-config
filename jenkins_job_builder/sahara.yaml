- job-template:
    name: 'tempest-{name}-tests'
    defaults: global
    builders:
      - gerrit-git-prep
      - ci-config-prep
      - shell: "FUNCTION_PATH=$WORKSPACE/sahara-ci-config/slave-scripts $WORKSPACE/sahara-ci-config/slave-scripts/tempest.sh"
    properties:
      - zeromq-event
      - build-blocker:
          blocking-jobs:
             - "tempest-.*-tests"
    publishers:
      - sahara-logs
      - console-log
      - trigger-cleanup
    node: trusty-neutron || trusty-nova

- job-template:
    name: 'gate-saharaclient-distributed-heat-fake'
    defaults: global
    builders:
      - gerrit-git-prep
      - ci-config-prep
      - shell: "FUNCTION_PATH=$WORKSPACE/sahara-ci-config/slave-scripts $WORKSPACE/sahara-ci-config/slave-scripts/gate-saharaclient.sh"
    properties:
      - zeromq-event
    publishers:
      - sahara-logs
      - console-log
      - trigger-cleanup
    node: trusty-neutron || trusty-nova

- job-template:
    name: '{pipeline}-{project_name}-{network}-{engine}-{plugin}-{os}'
    defaults: global
    builders:
      - gerrit-git-prep
      - ci-config-prep
      - shell: "FUNCTION_PATH=$WORKSPACE/sahara-ci-config/slave-scripts $WORKSPACE/sahara-ci-config/slave-scripts/gate-{project_name}.sh"
    properties:
      - zeromq-event
    publishers:
      - sahara-logs
      - console-log
      - trigger-cleanup
    node: 'trusty-{network}'

- job-template:
    name: '{pipeline}-{project_name}-{network}-{engine}-{plugin}-{os}-aio'
    defaults: global
    builders:
      - gerrit-git-prep
      - ci-config-prep
      - shell: "FUNCTION_PATH=$WORKSPACE/sahara-ci-config/slave-scripts $WORKSPACE/sahara-ci-config/slave-scripts/gate-{project_name}.sh"
    properties:
      - zeromq-event
    publishers:
      - sahara-logs
      - console-log
      - trigger-cleanup
    node: 'trusty-{network}'

- job-template:
    name: '{pipeline}-sahara_tests-{network}-{engine}-{plugin}-{os}-{release}'
    defaults: global
    builders:
      - gerrit-git-prep
      - ci-config-prep
      - shell: "FUNCTION_PATH=$WORKSPACE/sahara-ci-config/slave-scripts $WORKSPACE/sahara-ci-config/slave-scripts/gate-sahara_tests.sh"
    properties:
      - zeromq-event
    publishers:
      - sahara-logs
      - console-log
      - trigger-cleanup
    node: 'trusty-{network}'

- project:
    name: sahara
    pipeline:
      - gate
    project_name:
      - sahara
      - sahara_tests
    network: nova
    engine: direct
    plugin:
      - cdh_5.3.0
      - cdh_5.4.0
      - cdh_5.5.0
    os:
      - u12
      - c6.6
    jobs:
     - '{pipeline}-{project_name}-{network}-{engine}-{plugin}-{os}-aio'
     - '{pipeline}-{project_name}-{network}-{engine}-{plugin}-{os}':
          engine: heat
          plugin:
             - vanilla_2.6.0
             - vanilla_2.7.1
             - transient
             - mapr_5.0.0.mrv2
             - mapr_5.1.0.mrv2
          os: u14
          network: neutron
     - '{pipeline}-{project_name}-{network}-{engine}-{plugin}-{os}-aio':
          plugin:
             -  spark_1.0.0
             -  spark_1.3.1
             -  spark_1.6.0
          os: u14
          network: neutron
     - '{pipeline}-{project_name}-{network}-{engine}-{plugin}-{os}':
          network: nova
          engine: heat
          plugin:
            - ambari_2.3
          os: c6.6
     - 'tempest-{name}-tests'
     - '{pipeline}-sahara_tests-{network}-{engine}-{plugin}-{os}-{release}':
          plugin:
            - cdh_5.4.0
          release: liberty
     - '{pipeline}-sahara_tests-{network}-{engine}-{plugin}-{os}-{release}':
          network: neutron
          engine: heat
          plugin:
            - vanilla_2.7.1
          os: u14
          release:
            - liberty
            - mitaka
     - '{pipeline}-sahara_tests-{network}-{engine}-{plugin}-{os}-{release}':
          network: neutron
          plugin:
            - spark_1.3.1
          os: u14
          release:
            - liberty
            - mitaka
     - '{pipeline}-sahara_tests-{network}-{engine}-{plugin}-{os}-{release}':
          plugin:
            - cdh_5.5.0
          release: mitaka
     - '{pipeline}-sahara_tests-{network}-{engine}-{plugin}-{os}-{release}':
          network: neutron
          engine: heat
          plugin:
            - mapr_5.0.0.mrv2
            - spark_1.6.0
          os: u14
          release: mitaka
     - '{pipeline}-sahara_tests-{network}-{engine}-{plugin}-{os}-{release}':
          engine: heat
          plugin:
            - ambari_2.3
          os: c6.6
          release: mitaka

- project:
    name: sahara-nightly
    pipeline:
      - nightly
    project_name:
      - sahara_tests
    network: nova
    engine: direct
    plugin:
      - cdh_5.3.0
      - cdh_5.4.0
      - cdh_5.5.0
    os:
      - u12
      - c6.6
    jobs:
     - '{pipeline}-{project_name}-{network}-{engine}-{plugin}-{os}-aio'
     - '{pipeline}-{project_name}-{network}-{engine}-{plugin}-{os}':
          engine: heat
          plugin:
             - vanilla_2.6.0
             - vanilla_2.7.1
             - transient
             - mapr_5.0.0.mrv2
             - mapr_5.1.0.mrv2
          os: u14
          network: neutron
     - '{pipeline}-{project_name}-{network}-{engine}-{plugin}-{os}-aio':
          plugin:
             -  spark_1.0.0
             -  spark_1.3.1
             -  spark_1.6.0
          os: u14
          network: neutron
     - '{pipeline}-{project_name}-{network}-{engine}-{plugin}-{os}':
          network: nova
          engine: heat
          plugin:
            - ambari_2.3
          os: c6.6
     - '{pipeline}-sahara_tests-{network}-{engine}-{plugin}-{os}-{release}':
          plugin:
            - cdh_5.4.0
          release: liberty
     - '{pipeline}-sahara_tests-{network}-{engine}-{plugin}-{os}-{release}':
          network: neutron
          engine: heat
          plugin:
            - vanilla_2.7.1
          os: u14
          release:
            - liberty
            - mitaka
     - '{pipeline}-sahara_tests-{network}-{engine}-{plugin}-{os}-{release}':
          network: neutron
          plugin:
            - spark_1.3.1
          os: u14
          release:
            - liberty
            - mitaka
     - '{pipeline}-sahara_tests-{network}-{engine}-{plugin}-{os}-{release}':
          plugin:
            - cdh_5.5.0
          release: mitaka
     - '{pipeline}-sahara_tests-{network}-{engine}-{plugin}-{os}-{release}':
          network: neutron
          engine: heat
          plugin:
            - mapr_5.0.0.mrv2
            - spark_1.6.0
          os: u14
          release: mitaka
     - '{pipeline}-sahara_tests-{network}-{engine}-{plugin}-{os}-{release}':
          engine: heat
          plugin:
            - ambari_2.3
          os: c6.6
          release: mitaka

- project:
    name: saharaclient
    jobs:
     - 'gate-saharaclient-distributed-heat-fake'
     - 'tempest-{name}-tests'

- job:
    name: gate-sahara-pep8-trunk
    project-type: freestyle
    defaults: global
    description: "<b>This job is managed by Jenkins Job Builder, do not edit it through WebUI.\
                  \n<p>Please use this repository to make changes: <a href=\"https://git.openstack.org/openstack/sahara-ci-config\">https://git.openstack.org/openstack/sahara-ci-config</a></b>\
                 \n<p>This job runs pep8 check using trunk version of hacking"
    disabled: false
    node: trusty-neutron || trusty-nova
    builders:
    - gerrit-git-prep
    - ci-config-prep
    - shell: "$WORKSPACE/sahara-ci-config/slave-scripts/gate-sahara-pep8-trunk.sh"
    properties:
      - zeromq-event
    publishers:
      - console-log
