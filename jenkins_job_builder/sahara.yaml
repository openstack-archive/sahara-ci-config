- job:
    name: 'tempest-saharaclient-tests'
    defaults: global
    concurrent: false
    builders:
      - gerrit-git-prep
      - shell: |
              git clone https://git.openstack.org/stackforge/sahara-ci-config
              FUNCTION_PATH=$WORKSPACE/sahara-ci-config/slave-scripts $WORKSPACE/sahara-ci-config/slave-scripts/tempest.sh
    properties:
      - zeromq-event
      - build-blocker:
          blocking-jobs:
             - "tempest-sahara-tests"
    publishers:
      - sahara-logs
      - console-log
      - trigger-cleanup
    node: trusty-neutron || trusty-nova

- job:
    name: 'tempest-sahara-tests'
    defaults: global
    concurrent: false
    builders:
      - gerrit-git-prep
      - shell: |
              git clone https://git.openstack.org/stackforge/sahara-ci-config
              FUNCTION_PATH=$WORKSPACE/sahara-ci-config/slave-scripts $WORKSPACE/sahara-ci-config/slave-scripts/tempest.sh
    properties:
      - zeromq-event
      - build-blocker:
          blocking-jobs:
             - "tempest-saharaclient-tests"
    publishers:
      - sahara-logs
      - console-log
      - trigger-cleanup
    node: trusty-neutron || trusty-nova

- job-template:
    name: 'gate-saharaclient-neutron-{plugin-neutron}'
    defaults: global
    builders:
      - gerrit-git-prep
      - shell: |
              git clone https://git.openstack.org/stackforge/sahara-ci-config
              FUNCTION_PATH=$WORKSPACE/sahara-ci-config/slave-scripts $WORKSPACE/sahara-ci-config/slave-scripts/gate-saharaclient.sh
    properties:
      - zeromq-event
    publishers:
      - sahara-logs
      - console-log
      - trigger-cleanup
    node: 'trusty-neutron'

- job-template:
    name: 'gate-saharaclient-nova-{plugin-nova_network}'
    defaults: global
    builders:
      - gerrit-git-prep
      - shell: |
              git clone https://git.openstack.org/stackforge/sahara-ci-config
              FUNCTION_PATH=$WORKSPACE/sahara-ci-config/slave-scripts $WORKSPACE/sahara-ci-config/slave-scripts/gate-saharaclient.sh
    properties:
      - zeromq-event
    publishers:
      - sahara-logs
      - console-log
      - trigger-cleanup
    node: 'trusty-nova'

- job-template:
    name: 'gate-sahara-neutron-{plugin-neutron}'
    defaults: global
    builders:
      - gerrit-git-prep
      - shell: |
              git clone https://git.openstack.org/stackforge/sahara-ci-config
              FUNCTION_PATH=$WORKSPACE/sahara-ci-config/slave-scripts $WORKSPACE/sahara-ci-config/slave-scripts/gate-sahara.sh
    properties:
      - zeromq-event
    publishers:
      - sahara-logs
      - console-log
      - trigger-cleanup
    node: 'trusty-neutron'

- job-template:
    name: 'gate-sahara-nova-{plugin-nova_network}'
    defaults: global
    builders:
      - gerrit-git-prep
      - shell: |
              git clone https://git.openstack.org/stackforge/sahara-ci-config
              FUNCTION_PATH=$WORKSPACE/sahara-ci-config/slave-scripts $WORKSPACE/sahara-ci-config/slave-scripts/gate-sahara.sh
    properties:
      - zeromq-event
    publishers:
      - sahara-logs
      - console-log
      - trigger-cleanup
    node: 'trusty-nova'

- project:
    name: sahara
    github-org: openstack
    plugin-neutron:
     - direct-vanilla_1-aio
     - heat-vanilla_2.6
     - direct-spark-aio
     - direct-transient
     - heat-transient
    plugin-nova_network:
     - direct-cdh_ubuntu-aio
     - direct-cdh_centos-aio
     - direct-hdp_1-aio
     - heat-hdp_2
    jobs:
     - 'gate-sahara-neutron-{plugin-neutron}'
     - 'gate-sahara-nova-{plugin-nova_network}'
     - 'gate-saharaclient-neutron-{plugin-neutron}'
     - 'gate-saharaclient-nova-{plugin-nova_network}'

- job:
    name: integration-cleanup
    project-type: freestyle
    defaults: global
    description: "<b>This job is managed by Jenkins Job Builder, do not edit it through WebUI.\
                  \n<p>Please use this repository to make changes: <a href=\"https://git.openstack.org/stackforge/sahara-ci-config\">https://git.openstack.org/stackforge/sahara-ci-config</a></b>\
                 \n<p>This job destroys vms which were not deleted after integration tests"
    disabled: false
    node: 'master'

    parameters:
      - string:
          name: PREV_BUILD
          default: default
          description:
      - string:
          name: PREV_JOB
          default:
          description:
      - string:
          name: HOST_NAME
          default:
          description:

    builders:
    - shell: |
            rm -rf sahara-ci-config
            git clone https://git.openstack.org/stackforge/sahara-ci-config
            bash $WORKSPACE/sahara-ci-config/slave-scripts/integration-cleanup.sh

- job:
    name: gate-sahara-pep8-trunk
    project-type: freestyle
    defaults: global
    description: "<b>This job is managed by Jenkins Job Builder, do not edit it through WebUI.\
                  \n<p>Please use this repository to make changes: <a href=\"https://git.openstack.org/stackforge/sahara-ci-config\">https://git.openstack.org/stackforge/sahara-ci-config</a></b>\
                 \n<p>This job runs pep8 check using trunk version of hacking"
    disabled: false
    node: trusty-neutron || trusty-nova

    builders:
    - gerrit-git-prep
    - shell: |
            git clone https://git.openstack.org/stackforge/sahara-ci-config
            $WORKSPACE/sahara-ci-config/slave-scripts/gate-sahara-pep8-trunk.sh
    properties:
      - zeromq-event
    publishers:
      - console-log
