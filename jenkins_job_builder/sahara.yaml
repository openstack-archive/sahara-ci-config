- job-template:
    name: 'gate-saharaclient-integration-{plugin}'
    defaults: global
    concurrent: true
    builders:
      - gerrit-git-prep
      - shell: "rm -rf sahara-ci-config\
              \ngit clone https://github.com/stackforge/sahara-ci-config /tmp/sahara-ci-config\
              \nbash -x /tmp/sahara-ci-config/slave-scripts/gate-saharaclient-integration-new.sh"
    properties:
      - zeromq-event
    wrappers:
      - timeout:
          timeout: 120
          fail: true
      - timestamps
    publishers:
      - console-log
      - trigger-parameterized-builds:
          - project: "integration-cleanup"
            predefined-parameters:
               "PREV_BUILD=$BUILD_NUMBER-$ZUUL_CHANGE-$ZUUL_PATCHSET\
               \nPREV_JOB=$JOB_NAME\
               \nHOST_NAME=$NODE_NAME"
    node: 'precise'

- job-template:
    name: 'gate-sahara-integration-{plugin}'
    defaults: global
    concurrent: true
    builders:
      - gerrit-git-prep
      - shell: "rm -rf sahara-ci-config\
              \ngit clone https://github.com/stackforge/sahara-ci-config\
              \nbash -x sahara-ci-config/slave-scripts/gate-savanna-integration-new.sh"
    properties:
      - zeromq-event
    wrappers:
      - timeout:
          timeout: 120
          fail: true
      - timestamps
    publishers:
      - console-log
      - trigger-parameterized-builds:
          - project: "integration-cleanup"
            predefined-parameters:
               "PREV_BUILD=$BUILD_NUMBER-$ZUUL_CHANGE-$ZUUL_PATCHSET\
               \nPREV_JOB=$JOB_NAME
               \nHOST_NAME=$NODE_NAME"
    node: 'precise'

- project:
    name: savanna
    github-org: openstack
    plugin:
     - vanilla1
     - vanilla2
     - hdp1
     - hdp2
     - heat-vanilla1
     - heat-vanilla2
     - heat-hdp1
     - transient
    jobs:
     - 'gate-sahara-integration-{plugin}'
     - 'gate-saharaclient-integration-{plugin}'

- job:
    name: integration-cleanup
    project-type: freestyle
    defaults: global
    description: "<b>This job is managed by Jenkins Job Builder, do not edit it through WebUI.\
                  \n<p>Please use this repository to make changes: <a href=\"https://github.com/stackforge/sahara-ci-config\">https://github.com/stackforge/sahara-ci-config</a></b>\
                 \n<p>This job destroys vms which were not deleted after integration tests"
    disabled: false
    concurrent: false
    node: 'master'

    parameters:
      - string:
          name: PREV_BUILD
          default: default
          description:
      - string:
          name: PREV_JOB
          default:
          description:
      - string:
          name: HOST_NAME
          default:
          description:

    builders:
    - shell: "rm -rf sahara-ci-config\
            \ngit clone https://github.com/stackforge/sahara-ci-config\
            \nbash -x sahara-ci-config/slave-scripts/integration-cleanup.sh"

- job:
    name: gate-savanna-pep8-trunk
    project-type: freestyle
    defaults: global
    description: "<b>This job is managed by Jenkins Job Builder, do not edit it through WebUI.\
                  \n<p>Please use this repository to make changes: <a href=\"https://github.com/stackforge/sahara-ci-config\">https://github.com/stackforge/sahara-ci-config</a></b>\
                 \n<p>This job runs pep8 check using trunk version of hacking"
    disabled: false
    concurrent: true
    node: 'precise'

    builders:
    - gerrit-git-prep
    - shell: "rm -rf sahara-ci-config\
              \ngit clone https://github.com/stackforge/sahara-ci-config\
              \nbash -x sahara-ci-config/slave-scripts/gate-savanna-pep8-trunk.sh"
    properties:
      - zeromq-event
    publishers:
      - console-log
