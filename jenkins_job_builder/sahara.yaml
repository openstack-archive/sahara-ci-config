- job-template:
    name: 'tempest-{name}-tests'
    defaults: global
    builders:
      - gerrit-git-prep
      - shell: |
              git clone https://git.openstack.org/stackforge/sahara-ci-config
              FUNCTION_PATH=$WORKSPACE/sahara-ci-config/slave-scripts $WORKSPACE/sahara-ci-config/slave-scripts/tempest.sh
    properties:
      - zeromq-event
      - build-blocker:
          blocking-jobs:
             - "tempest-.*-tests"
    publishers:
      - sahara-logs
      - console-log
      - trigger-cleanup
    node: trusty-neutron || trusty-nova

- job-template:
    name: 'gate-{name}-{network}-{engine}-{plugin}'
    defaults: global
    builders:
      - gerrit-git-prep
      - shell: |
              git clone https://git.openstack.org/stackforge/sahara-ci-config
              FUNCTION_PATH=$WORKSPACE/sahara-ci-config/slave-scripts $WORKSPACE/sahara-ci-config/slave-scripts/gate-{name}.sh
    properties:
      - zeromq-event
    publishers:
      - sahara-logs
      - console-log
      - trigger-cleanup
    node: 'trusty-{network}'

- project:
    name: sahara
    github-org: openstack
    name:
     - sahara
     - saharaclient
    network:
     - neutron:
        engine:
         - direct:
            plugin:
             - vanilla_1.2.1-u14-aio
             - spark_1.0.0-u14-aio
             - transient-u14
         - heat:
            plugin:
             - vanilla_2.6.0-u14
             - transient-u14
             - mapr_4.0.2-u14
     - nova:
        engine:
         - direct:
            plugin:
             - cdh_5.3.0-u12-aio
             - cdh_5.3.0-c6.6-aio
             - hdp_1.3.2-c6.6-aio
         - heat:
            plugin: hdp_2.0.6-c6.6
    jobs:
     - 'gate-{name}-{network}-{engine}-{plugin}'
     - 'tempest-{name}-tests'

- job:
    name: gate-sahara-pep8-trunk
    project-type: freestyle
    defaults: global
    description: "<b>This job is managed by Jenkins Job Builder, do not edit it through WebUI.\
                  \n<p>Please use this repository to make changes: <a href=\"https://git.openstack.org/stackforge/sahara-ci-config\">https://git.openstack.org/stackforge/sahara-ci-config</a></b>\
                 \n<p>This job runs pep8 check using trunk version of hacking"
    disabled: false
    node: trusty-neutron || trusty-nova
    builders:
    - gerrit-git-prep
    - shell: |
            git clone https://git.openstack.org/stackforge/sahara-ci-config
            $WORKSPACE/sahara-ci-config/slave-scripts/gate-sahara-pep8-trunk.sh
    properties:
      - zeromq-event
    publishers:
      - console-log
