- job:
    name: 'dib-nova-heat-hdp_2'
    defaults: global
    concurrent: false
    builders:
      - gerrit-git-prep
      - shell: "rm -rf sahara-ci-config\
              \ngit clone https://git.openstack.org/stackforge/sahara-ci-config\
              \nFUNCTION_PATH=sahara-ci-config/slave-scripts/functions.sh bash -x sahara-ci-config/slave-scripts/dib.sh hdp_2"

    properties:
      - zeromq-event

    publishers:
      - scp:
          site: 'localhost'
          files:
            - target: 'logs/$LOG_PATH'
              source: '**/logs/*.txt'
              copy-after-failure: true
      - console-log
      - trigger-parameterized-builds:
          - project: "integration-cleanup"
            predefined-parameters:
               "PREV_BUILD=$BUILD_NUMBER-$ZUUL_CHANGE-$ZUUL_PATCHSET\
               \nPREV_JOB=$JOB_NAME\
               \nHOST_NAME=$NODE_NAME"
    node: 'trusty-nova'

- job-template:
    name: 'dib-{network}-direct-{plugin}-{os}-aio'
    defaults: global
    concurrent: false
    builders:
      - gerrit-git-prep
      - shell: "rm -rf sahara-ci-config\
              \ngit clone https://git.openstack.org/stackforge/sahara-ci-config\
              \nFUNCTION_PATH=sahara-ci-config/slave-scripts/functions.sh bash -x sahara-ci-config/slave-scripts/dib.sh {plugin} {os}"

    properties:
      - zeromq-event

    publishers:
      - scp:
          site: 'localhost'
          files:
            - target: 'logs/$LOG_PATH'
              source: '**/logs/*.txt'
              copy-after-failure: true
      - console-log
      - trigger-parameterized-builds:
          - project: "integration-cleanup"
            predefined-parameters:
               "PREV_BUILD=$BUILD_NUMBER-$ZUUL_CHANGE-$ZUUL_PATCHSET\
               \nPREV_JOB=$JOB_NAME\
               \nHOST_NAME=$NODE_NAME"
    node: 'trusty-{network}'

- job-template:
    name: 'dib-nova-direct-{plugin}-aio'
    defaults: global
    concurrent: false
    builders:
      - gerrit-git-prep
      - shell: "rm -rf sahara-ci-config\
              \ngit clone https://git.openstack.org/stackforge/sahara-ci-config\
              \nFUNCTION_PATH=sahara-ci-config/slave-scripts/functions.sh bash -x sahara-ci-config/slave-scripts/dib.sh {plugin}"

    properties:
      - zeromq-event

    publishers:
      - scp:
          site: 'localhost'
          files:
            - target: 'logs/$LOG_PATH'
              source: '**/logs/*.txt'
              copy-after-failure: true
      - console-log
      - trigger-parameterized-builds:
          - project: "integration-cleanup"
            predefined-parameters:
               "PREV_BUILD=$BUILD_NUMBER-$ZUUL_CHANGE-$ZUUL_PATCHSET\
               \nPREV_JOB=$JOB_NAME\
               \nHOST_NAME=$NODE_NAME"
    node: 'trusty-nova'

- job-template:
    name: 'dib-neutron-heat-{plugin}-{os}'
    defaults: global
    concurrent: false
    builders:
      - gerrit-git-prep
      - shell: "rm -rf sahara-ci-config\
              \ngit clone https://git.openstack.org/stackforge/sahara-ci-config\
              \nFUNCTION_PATH=sahara-ci-config/slave-scripts/functions.sh bash -x sahara-ci-config/slave-scripts/dib.sh {plugin} {os}"

    properties:
      - zeromq-event

    publishers:
      - scp:
          site: 'localhost'
          files:
            - target: 'logs/$LOG_PATH'
              source: '**/logs/*.txt'
              copy-after-failure: true
      - console-log
      - trigger-parameterized-builds:
          - project: "integration-cleanup"
            predefined-parameters:
               "PREV_BUILD=$BUILD_NUMBER-$ZUUL_CHANGE-$ZUUL_PATCHSET\
               \nPREV_JOB=$JOB_NAME\
               \nHOST_NAME=$NODE_NAME"
    node: 'trusty-neutron'

- project:
    name: sahara-image-elements
    github-org: openstack
    plugin:
     - vanilla_1
    os:
     - ubuntu
     - fedora
     - centos
    network:
     - neutron
    jobs:
     - 'dib-nova-heat-hdp_2'
     - 'dib-{network}-direct-{plugin}-{os}-aio'
     - 'dib-{network}-direct-{plugin}-{os}-aio':
          network: nova
          plugin: cdh
          os:
            - ubuntu
            - centos
     - 'dib-nova-direct-{plugin}-aio':
          plugin:
            - spark
            - hdp_1
     - 'dib-neutron-heat-{plugin}-{os}':
          plugin:
            - vanilla_2.4
            - vanilla_2.6

